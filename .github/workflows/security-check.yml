name: Secrets Scan

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Scan for potential secrets (exclude build/generated)
        run: |
          set -e
          echo "Scanning repository for potential secrets..."
          MATCHES=$(find . -type f \
            -not -path './.git/*' \
            -not -path './app/build/*' \
            -not -path './**/generated/*' \
            -not -path './**/google-services.json' \
            -print0 | xargs -0 grep -nEI \
            'AKIA[0-9A-Z]{16}|AIza[0-9A-Za-z_-]{35}|-----BEGIN (RSA )?PRIVATE KEY-----|aws_secret_access_key|ghp_[0-9A-Za-z]{36}|xox[baprs]-[0-9A-Za-z-]+' || true)
          if [ -n "$MATCHES" ]; then
            echo "Potential secrets detected:" && echo "$MATCHES"
            exit 1
          fi
          echo "No secrets detected."
